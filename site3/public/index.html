<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SDK test program</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
</head>

<body>
    <h1>AI SDK Test Program</h1>

    <div class="test-form">
        <label for="userPromptInput">User Prompt:</label>
        <input id="userPromptInput" type="text" />
        <br />
        <label for="systemPromptInput">System Prompt:</label>
        <input id="systemPromptInput" type="text" />
        <br />
        <label for="temperatureInput">Temperature:</label>
        <input type="range" id="temperatureInput" min="0" max="1" step="0.01" value="0.5">
        <br />
        <button onclick="callLlm('oneshot')">One-shot</button>
        <button onclick="callLlm('streamtest')">Text streaming</button>
        <button onclick="callLlm('chat')">Chat completion</button>
        <button onclick="callLlm('recipe')">Recipe generation</button><br />
        <button onclick="clearPrompts()" class="special">Clear Prompts</button>
        <button onclick="clearAll()" class="special">Clear All</button>
    </div>
    <zero-md class="hidden">
        <script type="text/markdown" id="response"></script>
    </zero-md>
    <div id="results" class="hidden"></div>
    <p>This is a test project based on the
        <a href="https://www.aihero.dev/vercel-ai-sdk-tutorial" target="_blank">Vercel AI SDK tutorial</a>.
    </p>

    <script>
        async function callLlm(method) {
            try {
                let path = "";
                switch (method) {
                    case 'oneshot':
                        path = "/api/oneshot";
                        break;
                    case 'streamtest':
                        path = "/api/streamtest";
                        break;
                    case 'chat':
                        path = "/api/chat";
                        break;
                    case 'recipe':
                        path = "/api/recipe";
                        break;
                    default:
                        throw new Error('Unknown method: ' + method);
                }

                showRequestInProgress();

                const userPrompt = 
                    document.getElementById('userPromptInput').value;
                const systemPrompt =
                    document.getElementById('systemPromptInput').value;
                const temperature = 
                    document.getElementById('temperatureInput').value;
                const response = await fetch(
                    `${path}?userPrompt=${encodeURIComponent(userPrompt)}&systemPrompt=${encodeURIComponent(systemPrompt)}&temperature=${encodeURIComponent(temperature)}`
                );
                const data = await response.json();
                
                showResults (data);

            } catch (error) {
                showResults('Error: ' + error.message);
            }
        }

        function showRequestInProgress() {
            document.getElementById('response')
                .textContent = 'Thinking ... ðŸ¤”';
            document.querySelector('zero-md')
                .classList.remove('hidden');
            document.getElementById('results')
                .classList.add('hidden');
        }

        function showResults(data) {

            // Show user prompt
            document.getElementById('userPromptInput')
                .value = data.userPrompt || '';

            // Show system prompt
            document.getElementById('systemPromptInput')
                .value = data.systemPrompt || '';

            // Show completion message
            document.getElementById('response')
                .textContent = data.completion || '';
            document.querySelector('zero-md')
                .classList.remove('hidden');

            // Show JSON results
            document.getElementById('results')
                .textContent = JSON.stringify(data, null, 2);
            document.getElementById('results')
                .classList.remove('hidden');
        }

        function clearPrompts() {
            document.getElementById('userPromptInput').value = '';
            document.getElementById('systemPromptInput').value = '';
        }

        function clearAll () {
            clearPrompts();
            document.getElementById('temperatureInput').value = '0.5';

            document.getElementById('response').textContent = '';
            document.querySelector('zero-md').classList.add('hidden');

            document.getElementById('results').textContent = '';
            document.getElementById('results').classList.add('hidden');
        }

    </script>
</body>

</html>
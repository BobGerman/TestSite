<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SDK test program</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
</head>

<body>
    <h1>AI SDK Test Program</h1>

    <div class="test-form">
        <label for="userPromptInput">User Prompt:</label>
        <input id="userPromptInput" type="text" />
        <br />
        <label for="systemPromptInput">System Prompt:</label>
        <input id="systemPromptInput" type="text" />
        <br />
        <button onclick="callLlm('oneshot')">One-shot</button>
        <button onclick="callLlm('streamtest')">Text streaming</button>
        <button onclick="callLlm('chat')">Chat completion</button>
        <button onclick="callLlm('recipe')">Recipe generation</button>
    </div>
    <zero-md class="hidden">
        <script type="text/markdown" id="response"></script>
    </zero-md>
    <div id="results" class="hidden"></div>
    <p>This is a test project based on the
        <a href="https://www.aihero.dev/vercel-ai-sdk-tutorial" target="_blank">Vercel AI SDK tutorial</a>.
    </p>

    <script>
        async function callLlm(method) {
            try {
                let path = "";
                switch (method) {
                    case 'oneshot':
                        path = "/api/oneshot";
                        break;
                    case 'streamtest':
                        path = "/api/streamtest";
                        break;
                    case 'chat':
                        path = "/api/chat";
                        break;
                    case 'recipe':
                        path = "/api/recipe";
                        break;
                    default:
                        throw new Error('Unknown method: ' + method);
                }

                showRequestInProgress();
                const userPrompt = document.getElementById('userPromptInput').value;
                const systemPrompt = document.getElementById('systemPromptInput').value;
                const response = await fetch(
                    `${path}?userPrompt=${encodeURIComponent(userPrompt)}&systemPrompt=${encodeURIComponent(systemPrompt)}`
                );

                const data = await response.json();
                showResults (data);

            } catch (error) {
                showResults('Error: ' + error.message);
            }
        }

        function showRequestInProgress() {
            const responseElement = document.getElementById('response');
            responseElement.textContent = 'Thinking ... ðŸ¤”';
            const zeroMdElement = document.querySelector('zero-md');
            zeroMdElement.classList.remove('hidden');

            const resultsDiv = document.getElementById('results');
            resultsDiv.classList.add('hidden');
        }

        function showResults(data) {

            // Show user prompt
            const userPromptInputElement = document.getElementById('userPromptInput');
            userPromptInputElement.value = data.userPrompt || '';

            // Show system prompt
            const systemPromptInputElement = document.getElementById('systemPromptInput');
            systemPromptInputElement.value = data.systemPrompt || '';

            // Show completion message
            const responseElement = document.getElementById('response');
            responseElement.textContent = data.completion || '';
            const zeroMdElement = document.querySelector('zero-md');
            zeroMdElement.classList.remove('hidden');

            // Show JSON results
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = JSON.stringify(data, null, 2);
            resultsDiv.classList.remove('hidden');
        }

    </script>
</body>

</html>